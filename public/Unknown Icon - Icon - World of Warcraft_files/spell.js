Listview.templates.spell={sort:["name","skill","level"],mode:WH.User.hasRole(U_GROUP_STAFF)&&!WH.isRetailTree()?Listview.MODE_CHECKBOX:Listview.MODE_DEFAULT,searchable:1,filtrable:1,completionText:LANG.lvcompletion_collection,columns:[{id:"name",name:WH.TERMS.name,type:"text",align:"left",span:2,value:"name",compute:function(b,d,c){let iconCell=WH.ce("td",{style:{width:"44px",padding:"3px 0 3px 12px",borderRight:"none"}});let icon;if(b.creates!=null){let min=parseInt(b.creates[1]);let max=parseInt(b.creates[2]);icon=g_items.createIcon(b.creates[0],1,(min||max)?min+((max&&max!==min)?"-"+max:""):"")}else{if(b.taughtby!=null&&g_items[b.taughtby]){icon=g_items.createIcon(b.taughtby,1);b.quality=g_items[b.taughtby].quality}else{icon=g_spells.createIcon(b.id,1)}}icon.style.cssFloat=icon.style.styleFloat="left";WH.ae(iconCell,icon);WH.ae(c,iconCell);d.style.borderLeft="none";let wrapper=WH.ce("div");let a=WH.ce("a",{className:"listview-cleartext",href:this.getItemLink(b)});if(!b.name){WH.error("Spell has no name! Using a placeholder.",b);b.name=WH.TERMS.openparenthesis_punct+WH.Types.getUpperSingular(WH.Types.SPELL)+" #"+b.id+WH.TERMS.closedparenthesis_punct}WH.ae(a,WH.ct(b.name));if(b.hasOwnProperty("quality")){a.classList.add("q"+b.quality)}if(b.frommerge){a.classList.add("icon-merge-right")}if(b.tooltipSpec){a.dataset.wowhead="spec="+b.tooltipSpec}WH.ae(wrapper,a);let rank=b.conduitRank;if(rank!==undefined){rank=WH.Strings.sprintf(WH.GlobalStrings.TRADESKILL_RANK_HEADER,rank+1)}else{rank=b.rank}if(rank){let rankDiv=WH.ce("div");rankDiv.className="small2";WH.ae(rankDiv,WH.ct(rank));WH.ae(wrapper,rankDiv)}if(this.showRecipeClass&&b.reqclass){let classDiv=WH.ce("div",{className:"small2"});let classes=Listview.funcBox.assocBinFlags(b.reqclass,g_chr_classes);for(let i=0,len=classes.length;i<len;++i){if(i>0){WH.ae(classDiv,WH.ct(WH.TERMS.comma_punct))}let className=WH.Wow.PlayerClass.getName(classes[i]);WH.ae(classDiv,WH.ce("a",{className:"c"+classes[i],href:WH.Entity.getPath(WH.Types.CLASS,classes[i],className)},WH.ct(className)))}WH.ae(wrapper,classDiv)}let nameInfo;if(b.nameInfo){nameInfo=WH.ce("div",undefined,WH.ct(b.nameInfo))}if(b.id>g_spells.WH_IDS){nameInfo=WH.ce("div",undefined,WH.ct(WH.TERMS.unreleasedspell))}if(b.reqrace){let side=WH.Wow.Race.getSide(b.reqrace);if(side){nameInfo=WH.ce("div",undefined,WH.ct(g_sides[side]))}else{nameInfo=WH.ce("div",{className:"q1"});let races=Listview.funcBox.assocBinFlags(b.reqrace,g_chr_races);for(let i=0,len=races.length;i<len;++i){if(i>0){WH.ae(nameInfo,WH.ct(WH.TERMS.comma_punct))}WH.ae(nameInfo,WH.ce("a",{href:WH.Entity.getPath(WH.Types.RACE,races[i],g_chr_races[races[i]])},WH.ct(g_chr_races[races[i]])))}}}if(nameInfo){wrapper.style.position="relative";nameInfo.classList.add("listview-name-info");WH.aef(wrapper,nameInfo)}WH.ae(d,wrapper)},getVisibleText:function(c){var f=c.name;if(c.rank){f+=" "+c.rank}if(c.conduitRank){f+=" "+c.conduitRank}if(c.reqclass){var e=Listview.funcBox.assocBinFlags(c.reqclass,g_chr_classes);for(var d=0,b=e.length;d<b;++d){if(d>0){f+=WH.TERMS.comma_punct}f+=g_chr_classes[e[d]]}}if(c.reqrace){f+=" "+Listview.funcBox.arrayText(Listview.funcBox.assocBinFlags(c.reqrace,g_chr_races),g_chr_races)}if((c.reqrace&1791)==1101){f+=" "+g_sides[1]}else{if((c.reqrace&1791)==690){f+=" "+g_sides[2]}}return f}},{id:"level",name:WH.TERMS.level,width:"10%",value:"level",compute:function(b,c){if(b.level>0){return b.level}},hidden:true},{id:"trainingcost",name:WH.TERMS.cost,width:"10%",hidden:true,getValue:function(b){if(b.trainingcost){return b.trainingcost}},compute:function(b,c){if(b.trainingcost){WH.ae(c,WH.Wow.buildMoney({copper:b.trainingcost}))}},sortFunc:function(d,c,e){if(d.trainingcost==null){return-1}else{if(c.trainingcost==null){return 1}}if(d.trainingcost<c.trainingcost){return-1}else{if(d.trainingcost>c.trainingcost){return 1}}return 0}},{id:"classes",name:WH.TERMS.classes,type:"text",hidden:true,width:"20%",getVisibleText:function(c){var f="";if(c.reqclass){var e=Listview.funcBox.assocBinFlags(c.reqclass,g_chr_classes);for(var d=0,b=e.length;d<b;++d){if(d>0){f+=WH.TERMS.comma_punct}f+=g_chr_classes[e[d]]}}return f},compute:function(c,j){if(c.reqclass){var f=Listview.funcBox.assocBinFlags(c.reqclass,g_chr_classes);var h=WH.ce("div");h.style.width=(26*f.length)+"px";h.style.margin="0 auto";for(var e=0,b=f.length;e<b;++e){var g=Icon.create("class_"+g_file_classes[f[e]],0,null,WH.Entity.getPath(WH.Types.CLASS,f[e],g_chr_classes[f[e]]));g.style.cssFloat=g.style.styleFloat="left";$(g).mouseover((function(d){return function(k){WH.Tooltip.showAtCursor(k,d,0,0,"q")}})(g_chr_classes[f[e]])).mousemove(function(d){WH.Tooltip.cursorUpdate(d)}).mouseout(function(){WH.Tooltip.hide()});WH.ae(h,g)}WH.ae(j,h)}},sortFunc:function(d,c,e){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(d.reqclass,g_chr_classes),Listview.funcBox.assocBinFlags(c.reqclass,g_chr_classes),g_chr_classes)}},{id:"singleclass",name:WH.TERMS["class"],type:"text",hidden:true,width:"15%",compute:function(b,f){if(b.reqclass){var c=Listview.funcBox.assocBinFlags(b.reqclass,g_chr_classes);var e=c[0];var d=$("<a>").css("background-image",'url("'+WH.staticUrl+"/images/wow/icons/tiny/class_"+g_file_classes[e]+'.gif")').addClass("icontiny tinyspecial").addClass("c"+e).attr("href",WH.Entity.getPath(WH.Types.CLASS,e,g_chr_classes[e])).text(g_chr_classes[e]);$(f).append(d)}},sortFunc:function(d,c,e){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(d.reqclass,g_chr_classes),Listview.funcBox.assocBinFlags(c.reqclass,g_chr_classes),g_chr_classes)}},{id:"glyphtype",name:WH.TERMS.glyphtype_stc,type:"text",hidden:true,width:"10%",compute:function(b,c){if(b.glyphtype){return g_item_glyphs[b.glyphtype]}}},{id:"guildlevel",name:WH.TERMS.guildlevel,width:"10%",value:"guildlevel",compute:function(b,c){if(b.guildlevel>0){return b.guildlevel}},hidden:true},{id:"schools",name:WH.TERMS.school,type:"text",width:"10%",hidden:true,compute:function(b,f){var e="";var d=b.schools?b.schools:b.school;for(var c=0;c<32;++c){if(!(d&(1<<c))){continue}if(e!=""){e+=", "}e+=g_spell_resistances[c]}return e},sortFunc:function(d,c,e){return WH.stringCompare(this.compute(d),this.compute(c))}},{id:"type",name:WH.TERMS.type,type:"text",width:"14%",hidden:true,compute:function(g,d){var c=WH.ce("div");c.className="small";if(WH.inArray([7,-2,-7,-12,-11,-13,-14,-16,-17,-18],g.cat)!=-1){var m=WH.ce("a");m.className="q0";m.href="/spells="+g.cat;WH.ae(m,WH.ct(g_spell_categories[g.cat]));WH.ae(c,m);WH.ae(c,WH.ce("br"));if(g.talentspec){var l=0,h;for(var f=0,k=g.talentspec.length;f<k;++f){var n=g.talentspec[f]&65535;if(this._wowClass&&(WH.inArray(g_chr_specs_by_class[this._wowClass],n)==-1)){continue}let specName=WH.Wow.PlayerClass.Specialization.getName(n);if(!specName){continue}if(l++>0){WH.ae(c,WH.ct(WH.TERMS.comma_punct))}h=g.reqclass||g.chrclass;if(h){h=(1+Math.log(g.reqclass)/Math.LN2)}else{for(var e in g_chr_specs_by_class){if(!g_chr_specs_by_class.hasOwnProperty(e)){continue}if(WH.inArray(g_chr_specs_by_class[e],n)>=0){h=e;break}}}var b=WH.ce("a");b.className="q1";b.href="/spells="+g.cat+"."+h+"."+n;WH.ae(b,WH.ct(specName));WH.ae(c,b)}if(l==0){h=g.reqclass||g.chrclass;if(h){for(f in g_chr_classes){if(!g_chr_classes.hasOwnProperty(f)){continue}if((h&Math.pow(2,parseInt(f,10)-1))!=0){if(l++>0){WH.ae(c,WH.ct(WH.TERMS.comma_punct))}var b=WH.ce("a");b.className="q1";b.href="/spells="+g.cat+"."+f;WH.ae(b,WH.ct(g_chr_classes[f]));WH.ae(c,b)}}}}}else{if(g_spell_types[g.cat]){if(g.cat==-11&&(g.type==1||g.type==2)){var b=WH.ce("a");b.className="q1";b.href="/spells="+g.cat+"?filter=cr=22;crs="+g.type+";crv=0";WH.ae(b,WH.ct(g_spell_types[g.cat][g.type]));WH.ae(c,b)}else{WH.ae(c,WH.ct(g_spell_types[g.cat][g.type]))}}else{if(g.reqclass){var b=WH.ce("a");b.className="q1";b.href="/spells="+g.cat+"."+(1+Math.log(g.reqclass)/Math.LN2)+(g_item_glyphs[g.glyphtype]?"?filter=gl="+g.glyphtype:"");WH.ae(b,WH.ct((g_item_glyphs[g.glyphtype]?g_item_glyphs[g.glyphtype]+" ":"")+g_chr_classes[(1+Math.log(g.reqclass)/Math.LN2)]));WH.ae(c,b)}}}}else{if(g_spell_categories[g.cat]){var m=WH.ce("a");m.className="q1";m.href="/spells="+g.cat;WH.ae(m,WH.ct(g_spell_categories[g.cat]));WH.ae(c,m)}}WH.ae(d,c)},getVisibleText:function(b){var c=g_spell_categories[b.cat];if(WH.inArray([7,-2,-12,-11,-13,-14,-16,-17,-18],b.cat)!=-1){if(b.talentspec){let specs=b.talentspec;(Array.isArray(specs)?specs:[specs]).forEach(function(d){c+=" "+WH.Wow.PlayerClass.Specialization.getName(d)})}else{if(g_spell_types[b.cat]){c+=" "+g_spell_types[b.cat][b.type]}else{if(g_item_glyphs[b.glyphtype]){c+=" "+g_item_glyphs[b.glyphtype]}c+=" "+g_chr_classes[(1+Math.log(b.reqclass)/Math.LN2)]}}}return c},sortFunc:function(d,c,e){var g=(g_spell_types[d.cat]?g_spell_types[d.cat][d.type]:d.type),f=(g_spell_types[c.cat]?g_spell_types[c.cat][c.type]:d.type);return WH.stringCompare(d.cat,c.cat)||WH.stringCompare(g,f)}},{id:"reagents",name:WH.TERMS.reagents,getValue:function(b){return(b.reagents?b.reagents.length:0)},compute:function(b,c){let items=b.reagents;if(!items){return}c.style.padding="0";for(let i=0,len=items.length;i<len;i++){let id=items[i][0];let num=items[i][1];let icon=g_items.createIcon(id,1,num);icon.style.display="inline-block";WH.ae(c,icon)}let optionalReagents=b.optionalReagents||[];for(let i=0,optionalReagent;optionalReagent=optionalReagents[i];i++){let icon=WH.Icon.create(WH.staticUrl+WH.Wow.Spell.OPTIONAL_REAGENT_ICON_PATH,WH.Icon.SMALL,WH.Strings.sprintf("/items?filter=243;%d;0",optionalReagent.id));icon.style.display="inline-block";WH.Tooltip.simple(icon,WH.Strings.sprintf(WH.TERMS.parens_format,optionalReagent.description||WH.GlobalStrings.EMPTY_OPTIONAL_REAGENT_TOOLTIP_TITLE,"#"+optionalReagent.id),undefined,true);WH.ae(c,icon)}},sortFunc:function(d,c){var f=(d.reagents!=null?d.reagents.length:0);var e=(c.reagents!=null?c.reagents.length:0);if(f>0&&f==e){return WH.stringCompare(d.reagents.toString(),c.reagents.toString())}else{return WH.stringCompare(f,e)}}},{id:"source",name:WH.TERMS.source,type:"text",width:"12%",hidden:true,compute:function(c,f){if(c.source!=null){var e="";for(var d=0,b=c.source.length;d<b;++d){if(d>0){e+=WH.TERMS.comma_punct}e+=g_sources[c.source[d]]}return e}},sortFunc:function(d,c,e){return Listview.funcBox.assocArrCmp(d.source,c.source,g_sources)}},{id:"side",name:WH.TERMS.side,type:"text",hidden:true,compute:function(b,d){if(b.side&&b.side!=3){var c=WH.ce("span");c.className=(b.side==1?"icon-alliance":"icon-horde");c.onmouseover=function(f){WH.Tooltip.showAtCursor(f,g_sides[b.side],0,0,"q")};c.onmousemove=WH.Tooltip.cursorUpdate;c.onmouseout=WH.Tooltip.hide;WH.ae(d,c)}},getVisibleText:function(b){if(b.side){return g_sides[b.side]}},sortFunc:function(d,c,e){return WH.stringCompare(g_sides[d.side],g_sides[c.side])}},{id:"itemsource",name:WH.TERMS.source,type:"text",hidden:true,compute:function(g,d){var l=g_items[g.taughtby];if(!l){return}if(this.iconSize==0){d.className="small"}if(l.attainable){return WH.TERMS.unavailable}else{if(l.source!=null){if(l.source.length==1){WH.noWrap(d);var c=(l.sourcemore?l.sourcemore[0]:{});if(c.t){var j=WH.ce("a");if(c.q!=null){j.className="q"+c.q}else{j.className="q1"}j.href=WH.Entity.getPath(c.t,c.ti,c.n);j.style.whiteSpace="nowrap";if(c.icon){j.className+=" icontiny tinyspecial";j.style.backgroundImage='url("'+WH.staticUrl+"/images/wow/icons/tiny/"+c.icon.toLowerCase()+'.gif")'}WH.ae(j,WH.ct(c.n));WH.ae(d,j)}else{WH.ae(d,WH.ct(WH.Wow.Item.getSourceCategory(l.source[0],c)))}var f=WH.Wow.Item.getSourceDescription(l.source[0],c);if(this.iconSize!=0&&f!=null){var b=WH.ce("div");b.className="small2";if(f.pretext){WH.ae(b,WH.ct(f.pretext))}if(f.url){var j=WH.ce("a");j.className="q1";j.href=f.url;WH.ae(j,WH.ct(f.text));WH.ae(b,j)}else{WH.ae(b,WH.ct(f.text))}if(f.posttext){WH.ae(b,WH.ct(f.posttext))}WH.ae(d,b)}}else{var k="";for(var e=0,h=l.source.length;e<h;++e){if(e>0){k+=WH.TERMS.comma_punct}k+=g_sources[l.source[e]]}return k}}}},getVisibleText:function(c){var d=g_items[c.taughtby];if(!d){return}if(d.attainable){return WH.TERMS.unavailable}else{if(d.source!=null){if(d.source.length==1){var f="";var e=(d.sourcemore?d.sourcemore[0]:{});if(e.t){f+=" "+e.n}else{f+=" "+WH.Wow.Item.getSourceCategory(d.source[0],e)}var b=WH.Wow.Item.getSourceDescription(d.source[0],e);if(b!=null){if(b.pretext){f+=" "+b.pretext}f+=" "+b.text;if(b.posttext){f+=" "+b.posttext}}return f}else{return Listview.funcBox.arrayText(d.source,g_sources)}}}},sortFunc:function(f,d){var f=g_items[f.taughtby];var d=g_items[d.taughtby];if(!f||!d){return 0}var g=Listview.funcBox.assocArrCmp(f.source,d.source,g_sources);if(g!=0){return g}var e=(f.sourcemore&&f.source.length==1?f.sourcemore[0].n:null),c=(d.sourcemore&&d.source.length==1?d.sourcemore[0].n:null);return WH.stringCompare(e,c)}},{id:"branch",name:WH.TERMS.branch,type:"text",width:"10%",hidden:true,compute:function(b,c){if(b.project){if(g_project_branches[b.project.branch]){$(c).append(g_project_branches[b.project.branch]+"<br />")}$(c).append("<small"+(!b.project.rarity?' class="q0"':"")+">"+g_project_rarity[b.project.rarity||0]+"</small>")}},getVisibleText:function(b){var c="";if(b.project){if(g_project_branches[b.project.branch]){c+=g_project_branches[b.project.branch]+" "}c+=g_project_rarity[b.project.rarity||0]}return c},sortFunc:function(d,c,e){if(!d.project||!c.project){return(d.project?1:(c.project?-1:0))}return WH.stringCompare(g_project_branches[d.project.branch],g_project_branches[c.project.branch])||-WH.stringCompare(d.project.rarity,c.project.rarity)}},{id:"fragments",name:WH.TERMS.fragments,type:"text",width:"10%",hidden:true,compute:function(c,d){if(c.project){if(!g_gatheredcurrencies[c.project.currency]){$.each(g_currencies,function(f,e){g_gatheredcurrencies[f]=[];g_gatheredcurrencies[f]["name_"+Locale.getName()]=e[0];g_gatheredcurrencies[f].icon=e[1]})}var b=$("<a/>",{href:WH.Entity.getPath(WH.Types.CURRENCY,c.project.currency),text:c.project.ncurrency});b.addClass("q1");b.addClass("icontinyr tip");b.css("background-image","url("+WH.staticUrl+"/images/wow/icons/tiny/"+g_gatheredcurrencies[c.project.currency].icon.toLowerCase()+".gif)");b.mouseover(function(f){WH.Tooltip.showAtCursor(f,g_gatheredcurrencies[c.project.currency]["name_"+Locale.getName()],0,0,"q")});b.mousemove(WH.Tooltip.cursorUpdate);b.mouseout(WH.Tooltip.hide);$(d).append(b)}},sortFunc:function(d,c,e){if(!d.project||!c.project){return(d.project?1:(c.project?-1:0))}return WH.stringCompare(d.project.ncurrency,c.project.ncurrency)||WH.stringCompare(d.project.currency,c.project.currency)}},{id:"keystone",name:WH.TERMS.keystone,type:"text",width:"10%",hidden:true,compute:function(b,e){if(b.project&&b.project.nkeystones&&g_items[b.project.keystone]){e.style.padding="0";var c=WH.ce("div");c.style.width="44px";c.style.margin="0 auto";WH.ae(c,g_items.createIcon(b.project.keystone,1,b.project.nkeystones));WH.ae(e,c)}},getVisibleText:function(b){if(b.project&&b.project.nkeystones&&g_items[b.project.keystone]){return g_items[b.project.keystone]["name_"+Locale.getName()]}},sortFunc:function(d,c,g){if(!d.project||!c.project){return(d.project?1:(c.project?-1:0))}var f=d.project.nkeystones&&g_items[d.project.keystone]?g_items[d.project.keystone]["name_"+Locale.getName()]:"";var e=c.project.nkeystones&&g_items[c.project.keystone]?g_items[c.project.keystone]["name_"+Locale.getName()]:"";return WH.stringCompare(f,e)||WH.stringCompare(d.project.nkeystones,c.project.nkeystones)}},{id:"skill",name:WH.TERMS.skill,type:"text",width:"20%",getValue:function(b){return b.learnedat},compute:function(v,g,b,k){if(v.skill!=null){this.skillsColumn=k;var l=WH.ce("div"),t;l.className="small";for(var n=0,p=v.skill.length;n<p;++n){if(n>0){WH.ae(l,WH.ct(WH.TERMS.comma_punct))}if(v.skill[n]==-1){WH.ae(l,WH.ct(WH.TERMS.ellipsis_punct))}else{if(WH.inArray([-3,-5,-6,-7,11,9],v.cat)!=-1){var c="";if((v.cat==-3)&&!(v.reqclass)){for(var r=0;r<mn_spells.length;r++){if(mn_spells[r][0]==-3){for(var q=0;q<mn_spells[r][3].length;q++){for(var o=0;o<mn_spells[r][3][q][3].length;o++){if(mn_spells[r][3][q][3][o][0]==v.skill[n]){c=mn_spells[r][3][q][0]+"."}}}}}}else{if(v.reqclass){c=""+(1+Math.log(v.reqclass)/Math.LN2)+"."}}var t=WH.ce("a");t.className="q1";if(WH.inArray([-5,-6],v.cat)!=-1){t.href="/spells="+v.cat}else{t.href="/spells="+v.cat+"."+c+v.skill[n]}var s=WH.getGets();var f=(s.spells?s.spells.split("."):[false,false]);if(v.reqclass&&(v.cat==7||v.cat==-2)){if(n<1&&((1+Math.log(v.reqclass)/Math.LN2)!=f[1])){var u=WH.ce("a");u.className="q0";u.href="/spells="+v.cat+"."+(1+Math.log(v.reqclass)/Math.LN2);WH.ae(u,WH.ct(g_chr_classes[(1+Math.log(v.reqclass)/Math.LN2)]));WH.ae(l,u);WH.ae(l,WH.ce("br"))}}WH.ae(t,WH.ct(g_spell_skills[v.skill[n]]));WH.ae(l,t)}else{if(WH.inArray([-2,7],v.cat)!=-1){var t=WH.ce("a");t.className="q1";t.href="/spells="+v.cat+"."+(v.reqclass?(1+Math.log(v.reqclass)/Math.LN2):"");WH.ae(t,WH.ct(g_spell_skills[v.skill[n]]));WH.ae(l,t)}else{WH.ae(l,WH.ct(g_spell_skills[v.skill[n]]))}}}}if(v.specialization&&g_skill_specializations[v.specialization]){var e=t.href;if(e){t=WH.ce("a");t.className="q1";t.href=e+"."+v.specialization;WH.ae(l,WH.ct(": "));WH.ae(t,WH.ct(g_skill_specializations[v.specialization]));WH.ae(l,t)}else{WH.ae(l,WH.ct(": "+g_skill_specializations[v.specialization]))}}if(v.learnedat>0){WH.ae(l,WH.ct(" ("));var j=WH.ce("span");if(v.learnedat==9999){j.className="q0";WH.ae(j,WH.ct("??"))}else{if(v.learnedat>0){WH.ae(j,WH.ct(v.learnedat));j.style.fontWeight="bold"}}WH.ae(l,j);WH.ae(l,WH.ct(")"))}WH.ae(g,l);if(v.colors!=null){this.columns[k].type=null;var h=v.colors,m=0;for(var n=0;n<h.length;++n){if(h[n]>0){++m;break}}if(m>0){m=0;l=WH.ce("div");l.className="small";l.style.fontWeight="bold";for(var n=0;n<h.length;++n){if(h[n]>0){if(m++>0){WH.ae(l,WH.ct(" "))}var d=WH.ce("span");d.className="r"+(n+1);WH.ae(d,WH.ct(h[n]));WH.ae(l,d)}}WH.ae(g,l)}}}else{if((v.reqclass)&&(WH.inArray([-2,7],v.cat)!=-1)){var l=WH.ce("div"),t;l.className="small";var t=WH.ce("a");t.className="q1";t.href="/spells="+v.cat+"."+(v.reqclass?(1+Math.log(v.reqclass)/Math.LN2):"");WH.ae(t,WH.ct(g_chr_classes[(1+Math.log(v.reqclass)/Math.LN2)]));WH.ae(l,t);WH.ae(g,l)}}},getVisibleText:function(b){var c=Listview.funcBox.arrayText(b.skill,g_spell_skills);if(b.specialization){c+=" "+(g_skill_specializations[b.specialization])}if(b.learnedat>0){c+=" "+(b.learnedat==9999?"??":b.learnedat)}return c},sortFunc:function(f,c){if(f.reqclass&&c.reqclass){var e=WH.stringCompare(g_chr_classes[(1+Math.log(f.reqclass)/Math.LN2)],g_chr_classes[(1+Math.log(c.reqclass)/Math.LN2)]);if(e){return e}}var d=[f.learnedat,c.learnedat];for(var h=0;h<2;++h){var j=(h==0?f:c);if(d[h]==9999&&j.colors!=null){var g=0;while(j.colors[g]==0&&g<j.colors.length){g++}if(g<j.colors.length){d[h]=j.colors[g]}}}var k=WH.stringCompare(d[0],d[1]);if(k!=0){return k}if(f.colors!=null&&c.colors!=null){for(var g=0;g<4;++g){if(f.hasOwnProperty("colors")&&c.hasOwnProperty("colors")&&f.colors.hasOwnProperty(g)&&c.colors.hasOwnProperty(g)){k=WH.stringCompare(f.colors[g],c.colors[g])}if(k!=0){return k}}}return Listview.funcBox.assocArrCmp(f.skill,c.skill,g_spell_skills)}},{id:"skillup",name:WH.TERMS.skillpoints,width:"10%",value:"nskillup",compute:function(b,c){if(b.nskillup>0){return b.nskillup}},hidden:true},{id:Listview.COLUMN_ID_COMPLETION,name:WH.TERMS.completion,hidden:true,compute:function(b,e,d,c){if(!b.hasOwnProperty("cat")||!Listview.templates.spell._validCompletionCategory(b.cat)){return}WH.addCompletionIcons(e,"spell",b.id)},sortFunc:function(d,c,e){return WH.stringCompare(WH.getCompletionFlags("spell",d.id),WH.getCompletionFlags("spell",c.id))},getValue:function(d){var f=0;var e=g_completion.spell;if((!d.hasOwnProperty("cat"))||(!Listview.templates.spell._validCompletionCategory(d.cat))){return-1}for(var g in g_user.lists){var b=g_user.lists[g];if(!(b.id in e)){continue}if(WH.inArray(e[b.id],d.id)!=-1){f++}}return f}}],getItemLink:function(b){let suffix="";if(b.conduitRank){suffix+="?rank="+b.conduitRank}return WH.Entity.getPath(WH.Types.SPELL,b.id,b.name)+suffix},_validCompletionCategory:function(b){return WH.inArray(g_completion_categories[6],b)!=-1},createCbControls:WH.User.hasRole(U_GROUP_STAFF)&&!WH.isRetailTree()?function(c,b){if(!b){return}let btnSetPhase=WH.ce("button",{className:"btn-primary"},WH.ct("Set Phase"));WH.aE(btnSetPhase,"click",this.template.setPhase.bind(this));WH.ae(c,btnSetPhase)}:undefined,createTooltipToggle:function(c,b){if(!b){return}this.addTooltipToggle(c,g_spells)},onBeforeCreate:function(){for(var b in this.columns){if((this.columns[b].id=="completed")&&(this.columns[b].hidden)){if(!(this.hasOwnProperty("completionMode")&&this.completionMode)&&WH.isRetailTree()&&WH.isSet("g_user")&&"lists"in g_user&&"spell"in g_completion&&WH.inArray(this.hiddenCols,this.columns[b].id)==-1){var c=0;for(var d in this.data){if(this.data[d].hasOwnProperty("cat")&&Listview.templates.spell._validCompletionCategory(this.data[d].cat)){c++}}if(c>(this.data.length*0.1)){this.visibility.push(parseInt(b))}}}}},setPhase:function(){var d=this.getCheckedRows();if(!d.length){return}var c=[];for(var b=0;b<d.length;b++){c.push(d[b].id)}WH.Wow.showContentPhasePrompt(WH.Types.SPELL,c)}};